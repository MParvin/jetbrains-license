<!DOCTYPE html>
<html lang="zh-CN" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JetBrains License Generator - 配置</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .navbar-brand {
            font-weight: bold;
        }
        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
        }
        .footer {
            background-color: #f8f9fa;
            border-top: 1px solid #dee2e6;
            margin-top: 3rem;
            padding: 2rem 0;
        }
        .warning-banner {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            font-weight: bold;
            text-align: center;
            padding: 0.75rem;
            margin-bottom: 1rem;
            border-radius: 0.375rem;
        }
        .form-label {
            font-weight: 600;
        }
        .is-invalid {
            border-color: #dc3545;
        }
        .invalid-feedback {
            display: block;
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-key me-2"></i>
                JetBrains License Generator
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="/">
                            <i class="fas fa-home me-1"></i>首页
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/config">
                            <i class="fas fa-cog me-1"></i>配置
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Warning Banner -->
    <div class="container mt-3">
        <div class="warning-banner">
            <i class="fas fa-exclamation-triangle me-2"></i>
            ⚠️ 以下仅供学习交流使用，禁止其它用途！！！ ⚠️
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Flash Messages -->
        <div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <span th:text="${success}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
        
        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
            <i class="fas fa-exclamation-circle me-2"></i>
            <span th:text="${error}"></span>
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>

        <!-- Configuration Form -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">
                            <i class="fas fa-cog me-2"></i>
                            许可证配置
                        </h5>
                    </div>
                    <div class="card-body">
                        <form th:action="@{/config}" th:object="${config}" method="post">
                            <div class="row">
                                <!-- 基本信息 -->
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3">
                                        <i class="fas fa-user me-1"></i>基本信息
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="licenseeName" class="form-label">证书持有者名称</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:class="${#fields.hasErrors('licenseeName')} ? 'form-control is-invalid' : 'form-control'"
                                               id="licenseeName" 
                                               th:field="*{licenseeName}" 
                                               placeholder="请输入证书持有者名称">
                                        <div th:if="${#fields.hasErrors('licenseeName')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{licenseeName}"></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="licenseYears" class="form-label">许可证有效期（年）</label>
                                        <input type="number" 
                                               class="form-control" 
                                               th:class="${#fields.hasErrors('licenseYears')} ? 'form-control is-invalid' : 'form-control'"
                                               id="licenseYears" 
                                               th:field="*{licenseYears}" 
                                               min="1" 
                                               max="50"
                                               placeholder="请输入有效期年数">
                                        <div th:if="${#fields.hasErrors('licenseYears')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{licenseYears}"></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="productType" class="form-label">产品类型</label>
                                        <select class="form-select" 
                                                th:class="${#fields.hasErrors('productType')} ? 'form-select is-invalid' : 'form-select'"
                                                id="productType" 
                                                th:field="*{productType}"
                                                onchange="updateProductCodes()">
                                            <option value="">请选择产品类型</option>
                                            <option th:each="product : ${productTypes}" 
                                                    th:value="${product.key}" 
                                                    th:text="${product.value}"></option>
                                        </select>
                                        <div th:if="${#fields.hasErrors('productType')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{productType}"></div>
                                    </div>
                                </div>
                                
                                <!-- 证书信息 -->
                                <div class="col-md-6">
                                    <h6 class="text-primary mb-3">
                                        <i class="fas fa-certificate me-1"></i>证书信息
                                    </h6>
                                    
                                    <div class="mb-3">
                                        <label for="issuerName" class="form-label">证书颁发者</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:class="${#fields.hasErrors('issuerName')} ? 'form-control is-invalid' : 'form-control'"
                                               id="issuerName" 
                                               th:field="*{issuerName}" 
                                               placeholder="请输入证书颁发者">
                                        <div th:if="${#fields.hasErrors('issuerName')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{issuerName}"></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="subjectName" class="form-label">证书主题</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:class="${#fields.hasErrors('subjectName')} ? 'form-control is-invalid' : 'form-control'"
                                               id="subjectName" 
                                               th:field="*{subjectName}" 
                                               placeholder="请输入证书主题">
                                        <div th:if="${#fields.hasErrors('subjectName')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{subjectName}"></div>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label for="certPath" class="form-label">证书存放路径</label>
                                        <input type="text" 
                                               class="form-control" 
                                               th:class="${#fields.hasErrors('certPath')} ? 'form-control is-invalid' : 'form-control'"
                                               id="certPath" 
                                               th:field="*{certPath}" 
                                               placeholder="请输入证书存放路径">
                                        <div th:if="${#fields.hasErrors('certPath')}" 
                                             class="invalid-feedback" 
                                             th:errors="*{certPath}"></div>
                                        <div class="form-text">证书文件将保存在此目录下</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 产品代码显示 -->
                            <div class="row mt-3">
                                <div class="col-12">
                                    <h6 class="text-primary mb-3">
                                        <i class="fas fa-code me-1"></i>产品代码
                                    </h6>
                                    <div class="alert alert-info">
                                        <strong>当前产品代码:</strong> 
                                        <span id="currentProductCodes" th:text="${#strings.arrayJoin(config.productCodes, ', ')}"></span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 操作按钮 -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <button type="submit" class="btn btn-primary me-2">
                                                <i class="fas fa-save me-1"></i>保存配置
                                            </button>
                                            <a href="/" class="btn btn-secondary">
                                                <i class="fas fa-arrow-left me-1"></i>返回首页
                                            </a>
                                        </div>
                                        <div>
                                            <button type="button" class="btn btn-outline-warning" onclick="resetForm()">
                                                <i class="fas fa-undo me-1"></i>重置表单
                                            </button>
                                            <form th:action="@{/reset}" method="post" style="display: inline;">
                                                <button type="submit" class="btn btn-outline-danger ms-2" 
                                                        onclick="return confirm('确定要重置为默认配置吗？')">
                                                    <i class="fas fa-refresh me-1"></i>恢复默认
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h6>JetBrains License Generator v2.0.0</h6>
                    <p class="text-muted mb-0">基于 Spring Boot 3.x 构建</p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="text-muted mb-0">
                        <i class="fas fa-code me-1"></i>
                        仅供学习交流使用
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        // 产品代码映射
        const productCodeMap = {
            'IDEA': ['II', 'PSI', 'PCWMP'],
            'WEBSTORM': ['WS', 'PSI', 'PCWMP'],
            'PYCHARM': ['PC', 'PSI', 'PCWMP'],
            'GOLAND': ['GO', 'PSI', 'PCWMP'],
            'CLION': ['CL', 'PSI', 'PCWMP'],
            'PHPSTORM': ['PS', 'PSI', 'PCWMP'],
            'RIDER': ['RD', 'PSI', 'PCWMP'],
            'DATAGRIP': ['DG', 'PSI', 'PCWMP'],
            'RUBYMINE': ['RM', 'PSI', 'PCWMP']
        };
        
        // 更新产品代码显示
        function updateProductCodes() {
            const productType = document.getElementById('productType').value;
            const codesElement = document.getElementById('currentProductCodes');
            
            if (productType && productCodeMap[productType]) {
                codesElement.textContent = productCodeMap[productType].join(', ');
            } else {
                codesElement.textContent = 'II, PSI, PCWMP';
            }
        }
        
        // 重置表单
        function resetForm() {
            if (confirm('确定要重置表单吗？')) {
                document.querySelector('form').reset();
                updateProductCodes();
            }
        }
        
        // 页面加载时更新产品代码
        document.addEventListener('DOMContentLoaded', function() {
            updateProductCodes();
        });
    </script>
</body>
</html>
